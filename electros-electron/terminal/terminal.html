<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../node_modules/@xterm/xterm/css/xterm.css" />
    <script src="../node_modules/@xterm/xterm/lib/xterm.js"></script>
    <link rel="stylesheet" href="../electros/css/style.css" />
    <style>
        body {
            margin: 0;
            background-color: #0a0e14 !important;
        }
        #terminal { 
            width: 100vw; 
            height: 100vh;
            font-size: 12px; /* Smaller font size */
            padding-top: 43px; /* Add top padding */
            padding-left: 13px;
        }
        .electros-titlebar-title {
            color: #ffa600 !important;
        }
    </style>
    <link rel="stylesheet" href="../titlebar/titlebar.css" />
    <title>Electros Daemons</title>
</head>
<body>
    <div class="electros-titlebar"></div>
    <div id="terminal"></div>
    <script>
        const { Terminal } = require('@xterm/xterm');
        const { ipcRenderer } = require('electron');
        const { Platform } = require('../common/Platform');

        const CurrentPlatform = new Platform();

        if (CurrentPlatform.isMac()) {
            document.querySelector('.electros-titlebar').innerHTML = `
            <div class='electros-titlebar-buttons electros-titlebar-buttons-align-left'>
                <button class='electros-titlebar-button' id='close-button'></button>
                <button class='electros-titlebar-button' id='minimize-button'></button>
                <button class='electros-titlebar-button' id='maximize-button'></button>
                <button class='electros-titlebar-button' id='fullscreen-button'></button>
            </div>
            `;
            document.querySelector('.electros-titlebar').classList.add('mac');
        } else {
            document.querySelector('.electros-titlebar').innerHTML = `
            <div class='electros-titlebar-buttons electros-titlebar-buttons-align-right'>
                <button class='electros-titlebar-button' id='minimize-button'></button>
                <button class='electros-titlebar-button' id='maximize-button'></button>
                <button class='electros-titlebar-button' id='close-button'></button>
            </div>
            `;
            if (CurrentPlatform.isLinux()) {
                document.querySelector('.electros-titlebar').classList.add('linux');
            } else {
                document.querySelector('.electros-titlebar').classList.add('win');
            }
        }

        const buttonActions = {
            'close-button': 'close-window',
            'hide-button': 'hide-window',
            'minimize-button': 'minimize-window',
            'maximize-button': 'toggle-full-screen',
            'fullscreen-button': 'maximize-window',
        };

        Object.entries(buttonActions).forEach(([buttonId, action]) => {
            const button = document.getElementById(buttonId);
            if (button) {
                button.addEventListener('click', () => {
                    ipcRenderer.invoke(action);
                });
            }
        });

        const term = new Terminal({
            fontSize: 12,
            lineHeight: 1.2,
            fontFamily: 'Menlo, Monaco, "Courier New", monospace',
            cursorBlink: true,
            cols: Math.floor(window.innerWidth / 8),
            rows: Math.floor(window.innerHeight / 16),
            convertEol: true,
            disableStdin: true,
            scrollback: 2000,
            theme: {
                background: '#0a0e14',
                foreground: '#ffa600'
            }
        });
        
        term.open(document.getElementById('terminal'));

        window.addEventListener('resize', () => {
            const terminalElement = document.getElementById('terminal');
            const availableWidth = window.innerWidth - 13; // Subtract left padding
            const availableHeight = window.innerHeight - 43; // Subtract top padding
            
            const newCols = Math.floor(availableWidth / 8); // Assuming 8px per character width
            const newRows = Math.floor(availableHeight / 16); // Assuming 16px per character height
            
            term.resize(newCols, newRows);
        });

        ipcRenderer.on('terminal-output', (event, data) => {
            term.write(data);
        });
    </script>
</body>
</html> 